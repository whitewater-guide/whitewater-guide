version: '3.3'
services:
  api:
    build:
      context: ../packages/backend
    depends_on:
      - db
      - minio
    deploy:
      placement:
        constraints: [node.role == manager]
  db:
    build: ../packages/db
    read_only: true
    deploy:
      placement:
        constraints: [node.role == manager]
  minio:
    read_only: true
    deploy:
      placement:
        constraints: [node.role == manager]
  imgproxy:
    image: 'darthsim/imgproxy:latest'
    read_only: true
    deploy:
      placement:
        constraints: [node.role == manager]
  caddy:
    build:
      context: ../packages/caddy
    read_only: true
    deploy:
      placement:
        constraints: [node.role == manager]
